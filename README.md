# Lenovo IdeaPad S540-14IML Hackintosh

![air14iml-ven](Images/cover.png)

ModelÔºöLenovo IdeaPad S540-14IML - Type 81NF


| Item                | Status |                         Details                         |
| :-------------------- | :------: | :-------------------------------------------------------: |
| üíª Computer model   |   ‚úÖ   |       Lenovo IdeaPad S540-14IML 2019 (Type 81NF)       |
| üåå OS Version       |   ‚úÖ   |                    Monterey/Ventura (13.3 & 13.5 ‚ö†Ô∏è PLEASE SKIP 13.4 ‚ö†Ô∏è)                    |
| üéõÔ∏è CPU            |   ‚úÖ   |            Intel Core i5-10210U / i7-10510U            |
| üéõÔ∏è Motherboard    |   ‚úÖ   |                    Lenovo 5B20W78206                    |
| üñêÔ∏è Fingerprint    |   ‚õî   |         Synaptics - Fingerprint will never work         |
| üé• GPU              |   ‚õî   |         Nvidia GeForce MX250 (Some models only)         |
| üé• iGPU             |   ‚úÖ   |                      Intel UHD 620                      |
| üí≥ Memory           |   ‚úÖ   |     Internal 4GB 2666 + Changeable 8GB 2666 memory     |
| üíΩ Disks            |   ‚úÖ   | Lenovo SSD 256G PCIe 2280 UMIS / Samsung SSD PM991 256G |
| üñ•Ô∏è Screen         |   ‚úÖ   |          AUO353D/LGD05EC (14-inches) 1920x1080          |
| üîä Audio Card       |   ‚úÖ   |                     Conexant CX8070                     |
| üåê Wireless         |   ‚úÖ   |     Replaced Atheros card with Broadcom BCM94360NG     |
| ü¶∑ Bluetooth        |   ‚úÖ   |                       BCM94360NG                       |
| üóÇÔ∏è SD card reader |   ‚úÖ   |         O2 MicroÔºàworkingÔºâ/ Realtek (workingÔºâ         |
| üñêÔ∏è TrackPad       |   ‚úÖ   |             Works in GPIO mode with Pin=50             |
| üì∫ HDMI             |   ‚úÖ   |        Able to output 4k@30fps, same as windows        |
| üì∏ Camera           |   ‚úÖ   |          It's pretty easy to drive USB camera          |
| üò¥ Sleep            |   ‚úÖ   |                  Support native sleep.                  |

## Current StatusÔºö

* üåå OS VersionÔºöMonterey / Ventura (Works well under 13.3 & 13.5, ‚ö†Ô∏è DO NOT USE IN 13.4 ‚ö†Ô∏è)
* üîä Audio CardÔºöSuccess with layout-id 15, no plosive Headsets with Microphone
* ‚¨áÔ∏è [Download](https://github.com/mandresve/Lenovo-IdeaPad-S540-Hackintosh/releases)

## Related models

* [Lenovo-XiaoXin-Air-14IML (i5-10210U/i7-10510U)](https://github.com/lietxia/XiaoXinAir14IML_2019_hackintosh)
* [Lenovo-Ideapad-S540-15IML (i5-10210U)](https://github.com/3ig/IdeaPad-S540-15IML-hackintosh)
* [Lenovo-Ideapad-S540-15IML (i5-10210U)](https://github.com/ayush5harma/IdeaPad-S540-Hackintosh)
* [Lenovo-Ideapad-S540-15IWL (i5-8265U)](https://github.com/IvanAleksandrov94/Lenovo-s340-s540-Big-Sur-OpenCore-i5-8265u)
* [Lenovo-Ideapad-S540-14IML (i5-10210U)](https://github.com/marianopela/Lenovo-Ideapad-S540-14IML-Hackintosh)
* [Lenovo-Ideapad-S540-14IWL (i5-8265U)](https://github.com/Hasodikis/Lenovo-Ideapad-s540-14IWL---Hackintosh)
* [Lenovo-Ideapad-S540-14IML (i5-10210U / i7-10510U)](https://github.com/mandresve/Lenovo-IdeaPad-S540-Hackintosh)

## BIOS

2022/05/13 BIOS Version: CKCN19WW https://download.lenovo.com/consumer/mobiles/ckcn19ww.exe

<details>
<summary>Details</summary>
2022/05/13 BIOS Version: CKCN19WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/94976/BIOS-CKCN19WW.exe <br />
2022/03/18 BIOS Version: CKCN18WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/92231/BIOS-CKCN18WW.exe <br />
2021/07/23 BIOS Version: CKEC17WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/83713/BIOS-CKCN17WW.exe <br />
2021/01/18 BIOS Version: CKCN16WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/78312/BIOS-CKCN16WW.exe <br />
2020/07/24 BIOS Version: CKCN15WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/73409/BIOS-CKCN15WW.exe <br />
2020/06/22 BIOS Version: CKCN14WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/72386/BIOS-CKCN14WW.exe <br />
2019/12/16 BIOS Version: CKCN12WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/67169/BIOS-CKCN12WW.exe <br />
2019/08/08 BIOS Version: CKCN11WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/60449/BIOS-CKCN11WW.exe <br />
</details>

## Microcode

2021/07/23 Version: CKME05WW https://newsupport.lenovo.com.cn/driveDownloads_detail.html?driveId=77695

<details>
<summary>Details</summary>
2021/07/23 Version: CKME05WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/83714/FW-CKME05WW.exe <br />
2020/12/17 Version: CKME03WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/77695/FW-CKME03WW.exe <br />
2020/06/23 Version: CKME02WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/72429/ME-CKME02WW.exe <br />
2019/12/16 Version: CKME01WW http://newdriverdl.lenovo.com.cn/newlenovo/alldriversupload/67174/FW-CKME01WW.exe <br />
</details>

## Advice

* [Prevent intermittent hackintosh disconnections Thanks @Unstoppablesss] Modify System Preferences/Eneragy Saver/Power Adapter/Put hard disk to sleep when possible(modify to off)
* Because current hibernate cannot wake up normally, in order to avoid affecting sleep, use  the terminal to turn off hibernate `sudo pmset -a hibernatemode 0`

### YogaSMC:

* Normal: Fan three modes switch, microphone mute, flight mode, F10 switch screen, touchpad switch hint, keyboard backlight, Fn function key switch.
* Abnormal: the camera has a hint, but it can't be turned off, the lock function can't be used, FN + Q can't work, the keyboard backlight will be displayed incorrectly when the power is plugged in, the battery temperature can't be read out, and you can't switch the charging speed in the system.

### Hi-DPI

bash -c "$(curl -fsSL https://raw.githubusercontent.com/xzhih/one-key-hidpi/dev/hidpi.sh)"

### Change DVMT and CFG Lock

> You must unlock `CFG Lock` , otherwise, you can't use OpenCore.
> We recommend to change `DVMT` into 64M, there's no damage to your computer.

* Recommend: get into hidden BIOS
  - The way to enter hidden BIOS
    - Switch off the `OneKeyBattery`
    - Press following buttons with your computer in shutdown state.
      - `F4` ‚Üí `4` ‚Üí `R` ‚Üí `F` ‚Üí `V`
      - `F5` ‚Üí `5` ‚Üí `T` ‚Üí `G` ‚Üí `B`
      - `F6` ‚Üí `6` ‚Üí `Y` ‚Üí `H` ‚Üí `N`
      - Power on ‚Üí Press F2, speed up if failed.

- Change the following settings.
  - `Advanced` ‚Üí `Power & Performance` ‚Üí `CPU - Power Management Control` ‚Üí `CPU Lock Configuration` ‚Üí `CFG Lock` ‚Üí `Disabled`
  - `Advanced` ‚Üí `System Agent (SA) Configuration` ‚Üí `Graphics Configuration` ‚Üí `DVMT Pre-Allocated` ‚Üí `64M`

* Backup solution: change in Windows
  * Refer to https://github.com/lietxia/XiaoXinAir14IML_2019_hackintosh/wiki/DVMT
  * `DVMT`Ôºö

    * Area : `SaSetup`
    * Offset : `0x107`
    * `01` to `02`
  * `CFG LOCK`Ôºö

    * Area : `CpuSetup`
    * Offset : `0x3E`
    * `01` to `00`

### The audio card isn't working.

Switching from win to mac will cause the audio card fail to syart. At this time, you need to turn it off and turn it on again, and the audio card will recoverConsultation got the answer: win restart is warm boot, will skip hardware detection, directly restart into mac will have problems

* Suggestion: switch from win to mac, do not restart, shut down first, and then turn on
* Restart from mac won't cause this.

### CPUFriend

With CPUFriend you can adjust the performance mode in this hackintosh. Please go deep in the folder CPUFriend to get detailed info. By default, this system is configured to get max battery life under i7-10510u processor. However, if you want to modify this, you have two options: 1. Replace the precompiled CPUFriendsDataProvider.kext as you like (Max Autonomy or Max Performance), or make a custom CPUFriendsDataProvider.kext using CPUFriendFriend or CPUFriend One Key (both provided under utilities folder). 

### Voltageshift

This systems support Voltageshift undervolting. Please refer to the official documentation to make it work.


## How to make it better?

* PrintScreen can't be used under mac. I map it to F13 and you can change the shortcut key of screenshot to F13
* Turn on HiDPI (see HiDPI part)

## SSDT


| SSDTs              | Info                                   | Necessary | Recommended | Optional |
| -------------------- | ---------------------------------------- | ----------- | ------------- | ---------- |
| SSDT-SBUS-MCHC     | Fake BUS0, DVL0, MCHC device           |           | ‚àö          |          |
| SSDT-EC-USBX       | Fake EC device, USB Power Patch        | ‚àö        |             |          |
| SSDT-TPAD-Air14IML | I2C Trachpad patch (AIR14IML only)     | ‚àö        |             |          |
| SSDT-DMAC          | Fake DMA controller                    |           |             | ‚àö       |
| SSDT-GPRW          | Anti immediate wakeup: 0D/6D           | ‚àö        |             |          |
| SSDT-PMC           | Fake PMC device                        |           | ‚àö          |          |
| SSDT-HPTE          | Disable HPET patch                     |           |             | ‚àö       |
| SSDT-PNLFCFL       | Coffee Lake PNLF patch                 | ‚àö        |             |          |
| SSDT-PR00          | X86 CPU Power Management (Enable XCPM) | ‚àö        |             |          |
| SSDT-RMCF-Air14IML | PS2 key mapping patch                  | ‚àö        |             |          |
| SSDT-UIAC          | Custom USB                             |           | ‚àö          |          |
| SSDT-BATX-Air14IML | Battery extra info                     |           |             | ‚àö       |
| SSDT-AWAC          | ‚ÄúFake‚Äù RTC timer                     |           | ‚àö          |          |
| SSDT-ECRW          | YogaSMC EC accessibility               |           |             | ‚àö       |

## Kexts


| Kexts                    | Info                  | Necessary | Optional |
| -------------------------- | ----------------------- | ----------- | ---------- |
| AirportBrcmFixup.kext    | DW1820A Wi-Fi         |           | ‚àö       |
| AppleALC.kext            | HDMI & Audio          | ‚àö        |          |
| Lilu.kext                | Kernel extension      | ‚àö        |          |
| SMCBatteryManager.kext   | SMC battery           | ‚àö        |          |
| SMCProcessor.kext        | SMC-processor         | ‚àö        |          |
| VirtualSMC.kext          | SMC(important)        | ‚àö        |          |
| VoodooI2C.kext           | Trackpad core         | ‚àö        |          |
| VoodooI2CHID.kext        | HID trackpad          | ‚àö        |          |
| VoodooPS2Controller.kext | Keyboard driver       | ‚àö        |          |
| WhateverGreen.kext       | IGPU driver           | ‚àö        |          |
| DebugEnhancer.kext       | Fix msgbuf            |           | ‚àö       |
| YogaSMC.kext             | YogaSMC               |           | ‚àö       |
| YogaSMCAlter.kext        | YogaSMC               |           | ‚àö       |
| RestrictEvents.kext      | Shield system daemons |           | ‚àö       |
| NVMeFix.kext             | improve nvme SSD      |           | ‚àö       |
| VerbStub.kext            | Microphone            |           | ‚àö       |

## Notes

* You need a T6 screwdriver to disassemble the machine. After the screws are removed, use the unused card and carefully disassemble it from the other side of the screen https://www.bilibili.com/video/BV1X341157kf/
* If you wan't to buy a type-c cable, you should buy one with 4mm diameter, and the hole diameter is 1.7mm
  ![IMG](Images/pd+luosi.png)

## Credits

- [Acidanthera](https://github.com/acidanthera) for [OpenCore](https://github.com/acidanthera/OpenCorePkg) and [other kexts](https://github.com/acidanthera).
- [Apple](https://www.apple.com) for [macOS](https://www.apple.com/macos).
- [lietxia](https://github.com/lietxia) for the base EFI.
- [mandresve](https://about.me/mandresve) for the clean & optimized EFI.
- [alexandred](https://github.com/alexandred) for developing [VoodooI2C](https://github.com/VoodooI2C/VoodooI2C).
- [athlonreg](https://github.com/athlonreg/) for developing [ALCPlugFix](https://github.com/athlonreg/AppleALC-ALCPlugFix) to fix microphone switch issue.
- [win1010525](https://github.com/win1010525) for add AIO version EFI.
- [sun19970908](https://github.com/sun19970908) for providing codec, modify ALCPlugFix and test CPUFriend.
- [stevezhengshiqi](https://github.com/stevezhengshiqi) for [one-key-cpufriend](https://github.com/stevezhengshiqi/one-key-cpufriend)
- [SoMeone](https://user.qzone.qq.com/504674749/infocenter) for modifying BIOS
